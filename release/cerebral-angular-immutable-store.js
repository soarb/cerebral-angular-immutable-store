!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("angular")):"function"==typeof define&&define.amd?define(["angular"],e):"object"==typeof exports?exports.Cerebral=e(require("angular")):t.Cerebral=e(t.angular)}(this,function(t){return function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return t[r].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){(function(e){var r=n(12),o=e.angular||n(18),i=n(13),u=n(16).EventEmitter,a=r.Value,s=function(t,e){var n=new u,o=i(t);t=o;var s=r.Controller({defaultArgs:e,onReset:function(){t=o},onSeek:function(e,r,o){t=t.import(o.initialState),n.emit("change",t)},onUpdate:function(){n.emit("change",t)},onRemember:function(){n.emit("remember",t)},onGet:function(e){return a(e,t)},onSet:function(e,n){e=e.slice();var r=e.pop();t=a(e,t).set(r,n)},onUnset:function(e){e=e.slice();var n=e.pop();t=a(e,t).unset(n)},onPush:function(e,n){t=a(e,t).push(n)},onSplice:function(){var e=[].slice.call(arguments),n=a(e.shift(),t);t=n.splice.apply(n,e)},onMerge:function(e,n){t=a(e,t).merge(n)},onConcat:function(){var e=[].slice.call(arguments),n=a(e.shift(),t);t=n.concat.apply(n,e)},onPop:function(e){t=a(e,t).pop()},onShift:function(e){t=a(e,t).shift()},onUnshift:function(e,n){t=a(e,t).unshift(n)}});return s.injectState=function(e,r){var o=function(n){Object.keys(r).forEach(function(o){e[o]=a(r[o],n||t)}),n&&e.$apply()};e.$on("$destroy",function(){n.removeListener("change",o)}),n.on("change",o),n.on("remember",o),o()},s};o.module("cerebral",[]).provider("cerebral",function(){var t=["$http"],e={},n={};this.setState=function(t){e=t},this.setDefaultArgs=function(t){n=t},this.$get=t.concat([function(){var r=arguments;return n.services=t.reduce(function(t,e,n){return t[e]=r[n],t},{}),new s(e,n)}])}),t.exports=o}).call(e,function(){return this}())},function(t,e){(function(e){t.exports={getFunctionName:function(t){var e=t.toString();return e=e.substr("function ".length),e=e.substr(0,e.indexOf("("))},merge:function(t,e){return e=e||{},Object.keys(e).reduce(function(t,n){return t[n]=e[n],t},t)},hasLocalStorage:function(){return"undefined"!=typeof e.localStorage},isPathObject:function(t){return t&&(t.resolve||t.reject)},debounce:function(t,e,n){var r;return function(){var o=this,i=arguments,u=function(){r=null,n||t.apply(o,i)},a=n&&!r;clearTimeout(r),r=setTimeout(u,e),a&&t.apply(o,i)}},isAction:function(t){return"function"==typeof t}}}).call(e,function(){return this}())},function(t,e){"use strict";var n={toJS:function(t){return t instanceof Array?t.map(function(t){return n.toJS(t)}):"object"==typeof t&&null!==t?Object.keys(t).reduce(function(e,r){return e[r]=n.toJS(t[r]),e},{}):t},makeImmutable:function(t){if(t instanceof Array){var e=t.map(function(t){return n.makeImmutable(t)});return Object.defineProperty(e,"toJS",{value:n.toJS.bind(null,e)}),Object.freeze(e),e}if("object"==typeof t&&null!==t){var e=Object.keys(t).reduce(function(e,r){return e[r]=n.makeImmutable(t[r]),e},{});return Object.defineProperty(e,"toJS",{value:n.toJS.bind(null,e)}),Object.freeze(e),e}return t},export:function(t,e){return t instanceof Array?t.map(function(t){return n.export(t,e)}):"object"==typeof t&&null!==t?Object.keys(t).reduce(function(r,o){return t.__&&e.get(t,o)?r[o]=e.get(t,o).value:r[o]=n.export(t[o],e),r},{}):t},import:function(t,e,r){return Object.keys(t).reduce(function(o,i){if(t[i]instanceof Array||"object"!=typeof t[i]||null===t[i]||!n.getByPath(o,r))return n.getByPath(o,r).set(i,t[i]);r.push(i);var u=n.import(t[i],e,r);return r.pop(),u},e.currentStore)},getByPath:function(t,e){return e.reduce(function(t,e){return t[e]},t)},isSame:function(t,e){return Object.keys(t).reduce(function(n,r){return!!n&&t[r]===e[r]},!0)},copyObject:function(t){return Object.keys(t).reduce(function(e,n){return e[n]=t[n],e},{})}};t.exports=n},function(t,e){t.exports=function(t,e){var n=[String,Number,Array,Object,Boolean];return(t!==String||"string"==typeof e)&&((t!==Number||"number"==typeof e)&&(!(t===Array&&!Array.isArray(e))&&((t!==Object||"object"==typeof e&&!Array.isArray(e)&&null!==e)&&((t!==Boolean||"boolean"==typeof e)&&(n.indexOf(t)!==-1||"function"!=typeof t||t(e))))))}},function(t,e,n){var r=n(2);t.exports=function(t){return{set:function(e,n,o,i){e.__.currentMapping[e.__.path.slice().concat(n).join("")]=r.copyObject(o),Object.keys(o.deps).forEach(function(n){var r=o.deps[n].join("");t.depsOverview[r]=t.depsOverview[r]||[],t.depsOverview[r].push(e)});var u=o.value,a=void 0,s=null,c=t.currentStore,f=function(){return Object.keys(o.deps).reduce(function(e,n){return e[n]=r.getByPath(t.currentStore,o.deps[n]),e},{})},l=function(){var t=f();return!r.isSame(t,s)};Object.defineProperty(e,n,{get:function(){return i&&(t.currentStore=i),c!==t.currentStore&&s&&l()?(s=f(),a=r.makeImmutable(o.get(u,s))):s&&l()?a=r.makeImmutable(o.get(u,s)):s&&void 0!==a?a:(s=f(),a=r.makeImmutable(o.get(u,s)))},set:function(t){u=t,o.value=t},enumerable:!0,configurable:!0})},get:function(e,n){return t.currentStore.__.currentMapping[e.__.path.slice().concat(n).join("")]}}}},function(t,e,n){n(1);t.exports=function(t,e,n){var r=null,o=null,i=[],u=0,a=null,s=null,c=!1,f=!1,l=!1,p=0;return{seek:function(u,s){if(clearTimeout(o),i.forEach(clearTimeout),n.onSeek&&n.onSeek(u,!!s,r),!t.isRemembering()){var f=function(t){for(var n=t.name.split("."),r=e;n.length;)r=r[n.shift()];r.call(null,t.payload,t.asyncActionResults.slice())},p=r.signals.filter(function(t){return t.start-r.start<u});if(l=!0,p.forEach(f),l=!1,s){this.createTimer();for(var h=r.signals.length,g=p.length,d=g;d<h;d++){var v=r.signals[d],y=v.start-r.start-u;i.push(setTimeout(f.bind(null,v),y))}c=!0,a=Date.now()}i.push(setTimeout(function(){c=!1,n.onUpdate&&n.onUpdate()},r.end-r.start-u)),n.onUpdate&&n.onUpdate()}},createTimer:function(){var t=function(){u+=500,n.onDurationChange&&n.onDurationChange(u),u<r.duration&&(o=setTimeout(t,500),n.onUpdate&&n.onUpdate())}.bind(this);o=setTimeout(t,500)},resetState:function(){n.onRecorderReset&&n.onRecorderReset(r.initialState)},record:function(){t.isRemembering()||(r&&this.resetState(),r={initialState:n.onGetRecordingState&&n.onGetRecordingState(),start:Date.now(),signals:[]},f=!0,n.onUpdate&&n.onUpdate())},stop:function(){var e=c;if(clearTimeout(o),c=!1,f=!1,!t.isRemembering()&&!e){if(t.isExecutingAsync())throw new Error("Cerebral - You can not stop when async signals are running, make sure to handle that with: cerebral.hasExecutingSignal()");r.end=Date.now(),r.duration=r.end-r.start,n.onUpdate&&n.onUpdate()}},pause:function(){if(t.isExecutingAsync())throw new Error("Cerebral - You can not stop when async signals are running, make sure to handle that with: cerebral.hasExecutingSignal()");t.isRemembering()||(s=Date.now(),p=s-a,clearTimeout(o),i.forEach(clearTimeout),n.onUpdate&&n.onUpdate())},addSignal:function(t){r.signals.push(t)},isRecording:function(){return f},isPlaying:function(){return c},isCatchingUp:function(){return l},getRecording:function(){return r},getCurrentSeek:function(){return p}}}},function(t,e,n){(function(e){var r=n(1),o=n(10),i=n(11),u=n(9),a=n(3),s=[],c=!1,f=e.requestAnimationFrame||function(t){setTimeout(t,0)};t.exports=function(t,e,n,l){return function(){var p=[].slice.call(arguments),h=p.shift(),g=p;return u(h,g),function(){var u=g.slice(),p=arguments[0]===!0,d=p,v=p?arguments[1]:arguments[0],y=p?arguments[2]:arguments[1],m=function(){var s=v||{},c=Date.now(),f={name:h,start:c,actions:[],duration:0,payload:v,asyncActionResults:[]};e.isRecording()&&e.addSignal(f),t.addSignal(f);var p=function(){if(u.length){var h=u.shift();if(h.input&&Object.keys(h.input).forEach(function(t){if("undefined"==typeof s[t]||!a(h.input[t],s[t]))throw new Error(['Cerebral: You are giving the wrong input to the action "'+r.getFunctionName(h)+'" in signal "'+f.name+'". Check the following prop: "'+t+'"'].join(""))}),Array.isArray(h)){var g=h.slice();if(t.isRemembering()||e.isPlaying()){for(;y.length;){var d=y.shift();if(g.shift(),r.merge(s,d.arg),d.path){var v=g.shift();u.splice.apply(u,[0,0].concat(v[d.path]))}}p()}else{l.onUpdate&&l.onUpdate();var m=Date.now()-c;f.duration=f.duration>m?f.duration:m,t.addAsyncAction();var b=[];Promise.all(g.map(function(t){if(r.isAction(t)){var e=o.async(f.actions,s,l),n={name:r.getFunctionName(t),duration:0,mutations:[],output:null,path:null,isAsync:!0};f.actions.push(n),b.push(n);var u=i.async(t);return t.apply(null,e.concat(u.fn)),u.promise}return t})).then(function(e){for(;e.length;){var n=e.shift(),o=b.shift();if(f.asyncActionResults.push(n),o.output=n.arg,r.merge(s,n.arg),n.path){var i=e.shift();o.path=n.path,u.splice.apply(u,[0,0].concat(i[n.path]))}}t.removeAsyncAction(),c=Date.now(),p()}).catch(function(t){throw l.onError&&l.onError(t),t}),n&&n.update()}}else try{var _=o.sync(f.actions,s,l),w={name:r.getFunctionName(h),duration:0,isParallell:!1,mutations:[],output:null,isAsync:!1};f.actions.push(w);var S=i.sync(h,f.name);h.apply(null,_.concat(S));var d=S._result||{};if(r.merge(s,d.arg),w.output=d.arg,d.path){var v=u.shift();u.splice.apply(u,[0,0].concat(v[d.path]))}p()}catch(t){throw l.onError&&l.onError(t),t}}else if(!t.isRemembering()&&!e.isCatchingUp()){l.onUpdate&&l.onUpdate();var m=Date.now()-c;f.duration=f.duration>m?f.duration:m,n&&n.update()}};p()};d||t.isRemembering()||e.isCatchingUp()?m():(s.push(m),c||(f(function(){for(;s.length;)s.shift()();c=!1}),c=!0))}}}}).call(e,function(){return this}())},function(t,e,n){(function(e){var r=n(1);t.exports=function(t,n){var o=r.hasLocalStorage()&&localStorage.getItem("cerebral_signals")?JSON.parse(localStorage.getItem("cerebral_signals")):[],i=("undefined"==typeof e||"production"!==e.env.NODE_ENV)&&(!r.hasLocalStorage()||!localStorage.getItem("cerebral_willKeepState")||JSON.parse(localStorage.getItem("cerebral_willKeepState"))),u=0,a=!1,s=o.length-1;return{toggleKeepState:function(){i=!i},addAsyncAction:function(){u++},removeAsyncAction:function(){u--},addSignal:function(t){s++,a||(i||(o=[],s=0),s<o.length&&o.splice(s,o.length-s),o.push(t))},rememberNow:function(){o.length&&this.remember(o.length-1)},reset:function(){a||(o=[],s=-1,n.onReset&&n.onReset())},remember:function(e){if(a=!0,n.onReset&&n.onReset(),e===-1)s=e,a=!1;else{s=-1;try{for(var r=0;r<=e;r++){var i=o[r];if(!i)break;for(var u=i.name.split("."),c=t;u.length;)c=c[u.shift()];c.call(null,i.payload,i.asyncActionResults.slice()),s=r}a=!1}catch(t){a=!1,this.reset()}}n.onRemember&&n.onRemember()},getSignals:function(){return o},isExecutingAsync:function(){return!!u},isRemembering:function(){return a},willKeepState:function(){return i},getCurrentIndex:function(){return s}}}}).call(e,n(17))},function(t,e,n){var r=n(1);t.exports=function(t,e){var n=function(){return{props:{signals:t.getSignals(),willKeepState:t.willKeepState(),currentSignalIndex:t.getCurrentIndex(),isExecutingAsync:t.isExecutingAsync(),isRemembering:t.isRemembering()}}},o=r.debounce(function(){var t=new CustomEvent("cerebral.dev.update",{detail:n()});window.dispatchEvent(t)},50),i=function(){var t=new CustomEvent("cerebral.dev.initialized",{detail:n()});window.dispatchEvent(t)};return window.addEventListener("cerebral.dev.initialize",function(){t.remember(t.getSignals().length-1),i()}),i(),window.addEventListener("cerebral.dev.toggleKeepState",function(){t.toggleKeepState(),o()}),window.addEventListener("cerebral.dev.resetStore",function(){t.reset(),e.onUpdate&&e.onUpdate(),o()}),window.addEventListener("cerebral.dev.remember",function(e){t.remember(e.detail),o()}),window.addEventListener("cerebral.dev.logPath",function(t){var n=t.detail.name,r=e.onGet(t.detail.path);console.log("CEREBRAL - "+n+":",r.toJS?r.toJS():r)}),window.addEventListener("unload",function(){r.hasLocalStorage()&&localStorage.setItem("cerebral_signals",JSON.stringify(t.getSignals())),r.hasLocalStorage()&&localStorage.setItem("cerebral_willKeepState",JSON.stringify(t.willKeepState()))}),{update:o}}},function(t,e,n){var r=n(1);t.exports=function(t,e){var n=function(e,o,i){e.forEach(function(u,a){if(Array.isArray(u))n(u,e,a);else{var s=e[a+1];if(u.output&&(o&&"function"==typeof s||!o&&("function"!=typeof s||!s)||o&&"function"!=typeof o[i+1]))throw new Error(['Cerebral: The action "'+r.getFunctionName(u)+'" in signal "'+t+'" has an output definition, but there is no action to receive it. '+(s?"But there are "+JSON.stringify(Object.keys(s))+" paths, should it be outputs?":"")].join(""));if(u.outputs&&(!s||"function"==typeof s))throw new Error(['Cerebral: The action "'+r.getFunctionName(u)+'" in signal "'+t+'" has an output value. There should be these paths: '+JSON.stringify(Object.keys(u.outputs))].join(""));if(Array.isArray(u.outputs)){var s=e[a+1];u.outputs.forEach(function(e){if(!Array.isArray(s[e]))throw new Error(['Cerebral: The action "'+r.getFunctionName(u)+'" in signal "'+t+'" can not find path to its "'+e+'" output'].join(""))})}else u.outputs&&Object.keys(u.outputs).forEach(function(e){if(!Array.isArray(s[e]))throw new Error(['Cerebral: The action "'+r.getFunctionName(u)+'" in signal "'+t+'" can not find path to its "'+e+'" output'].join(""))})}})};n(e)}},function(t,e,n){var r=n(1),o=["unset","shift","pop"],i=function(t,e,n){return function(r,i){var u=i.toLowerCase();return r[i.toLowerCase()]=function(){var r=null,a=null;if("get"===u)return r="string"==typeof arguments[0]?[].slice.call(arguments):arguments[0],e.onGet&&e.onGet(r);if(n)throw new Error("Cerebral: You can not mutate state in async actions. Output values and set them with a sync action");return o.indexOf(u)>=0?(r="string"==typeof arguments[0]?[].slice.call(arguments):arguments[0],a=[]):"merge"===u?(r=1===arguments.length?[]:arguments[0],a=1===arguments.length?[arguments[0]]:[arguments[1]]):(r="string"==typeof arguments[0]?[arguments[0]]:arguments[0],a=[].slice.call(arguments).splice(1)),t[t.length-1].mutations.push({name:u,path:r.slice(),args:a}),e["on"+i]&&e["on"+i].apply(null,[r].concat(a))},r}};t.exports={sync:function(t,e,n){return[r.merge(r.merge({},e),n.defaultArgs||{}),["Get","Set","Unset","Push","Concat","Shift","Unshift","Merge","Splice","Pop"].reduce(i(t,n),{})]},async:function(t,e,n){return[r.merge(r.merge({},e),n.defaultArgs||{}),["Get","Set","Unset","Push","Concat","Shift","Unshift","Merge","Splice","Pop"].reduce(i(t,n,!0),{})]}}},function(t,e,n){var r=n(1),o=n(3),i=function(t,e,n,i){if((t.output||t.outputs)&&!Array.isArray(t.outputs)){if(!n)throw new Error(['Cerebral: There is no output of action "'+r.getFunctionName(t)+'" in signal "'+i+'". It should have '+JSON.stringify(Object.keys(t.output||t.outputs[e]))].join(""));var u=t.output||t.outputs[e||t.defaultOutput];Object.keys(u).forEach(function(e){if(!o(u[e],n[e]))throw new Error(['Cerebral: There is a wrong output of action "'+r.getFunctionName(t)+'" in signal "'+i+'". Check the following prop: "'+e+'"'].join(""))})}},u=function(t,e,n){var o=function(){var u="string"==typeof arguments[0]?arguments[0]:null,a=u?arguments[1]:arguments[0];if(!u&&!t.defaultOutput&&t.outputs)throw new Error(['Cerebral: There is a wrong output of action "'+r.getFunctionName(t)+'" in signal "'+e+'". Set defaultOutput or use one of outputs '+JSON.stringify(Object.keys(t.output||t.outputs))].join(""));i(t,u,a,e);var s={path:u?u:t.defaultOutput,arg:a};n?n(s):o._result=s};return o},a=function(t,e){t.outputs?Array.isArray(t.outputs)?t.outputs.forEach(function(t){e[t]=e.bind(null,t)}):Object.keys(t.outputs).forEach(function(t){e[t]=e.bind(null,t)}):(e.success=e.bind(null,"success"),e.error=e.bind(null,"error"))};t.exports={sync:function(t,e){var n=u(t,e);return a(t,n),n},async:function(t,e){var n=null,r=new Promise(function(t){n=t}),o=u(t,e,n);return a(t,o),{fn:o,promise:r}}}},function(t,e,n){var r=n(6),o=n(7),i=n(5),u=n(8);t.exports={Controller:function(t){t=t||{};var e={},n=null,a=o(e,t);"undefined"!=typeof window&&"undefined"!=typeof window.addEventListener&&(n=u(a,t));var s=i(a,e,t),c=r(a,s,n,t);return{signal:function(){e[arguments[0]]=c.apply(null,arguments)},signals:e,store:a,recorder:s,get:function(){var e=arguments.length?"string"==typeof arguments[0]?[].slice.call(arguments):arguments[0]:[];return t.onGet(e)}}},Value:function(t,e){for(t=t.slice();t.length;)e=e[t.shift()];return e}}},function(t,e,n){"use strict";function r(t){if(!t||"object"!=typeof t||Array.isArray(t)||null===t)throw new Error("You have to pass an object to the store");var e={currentPath:[],currentStore:null,mapper:null,currentMapping:{},depsOverview:{},update:function(t,n){e.currentMapping=a.copyObject(e.currentMapping);var r=t.__.path.join("");return e.depsOverview[r]&&e.depsOverview[r].forEach(function(t){e.currentStore=f(e,t)}),e.currentStore=f(e,t,n),e.currentStore},updateMapping:function(t,n,r){return e.currentStore=f(e,t,function(t,e,o){e.mapper.set(t,n,e.mapper.get(t,n)),e.currentPath.push(n),t[n]=r,e.currentPath.pop()}),e.currentStore}};return e.mapper=u(e),e.currentStore=l(e,t),e.currentStore}var o=n(14),i=n(15),u=n(4),a=n(2),s=function(t,e){return Array.isArray(t)?o(t,e):"object"==typeof t&&null!==t?i(t,e):t},c=function(t,e){if(Array.isArray(e)&&!e.__){var n=e.map(function(e,n){t.currentPath.push(n);var r=c(t,e);return t.currentPath.pop(),r}),r=o(n,t);return Object.freeze(r),r}if("object"!=typeof e||null===e||e.__)return e;var u=Object.keys(e).reduce(function(n,r){return t.currentPath.push(r),n[r]=c(t,e[r]),t.currentPath.pop(),n},{}),a=i(u,t);return Object.freeze(a),a},f=function(t,e,n){t.currentPath=[];var r=e.__.path;r.length||(t.currentStore=e);var o=s(t.currentStore,t),u=o;r.forEach(function(e){t.currentPath.push(e),u[e]=s(u[e],t),u=u[e]}),n&&n(u,t,c),u=o,r.forEach(function(e){u=u[e],Object.freeze(u),t.currentPath.pop()});var f=i(o,t);return Object.keys(o).forEach(function(e){var n=Object.getOwnPropertyDescriptor(o,e);n&&n.get&&n.set?Object.defineProperty(f,e,{get:function(){return t.currentStore=this,n.get()}}):Object.defineProperty(f,e,{enumerable:!0,get:function(){return t.currentStore=this,o[e]}})}),Object.defineProperty(f,"export",{enumerable:!1,value:function(){return a.export(f,t.mapper)}}),Object.defineProperty(f,"import",{enumerable:!1,value:function(e){return a.import(e,t,[])}}),Object.freeze(f),f},l=function(t,e){var n=i({},t);return Object.keys(e).forEach(function(r){t.currentPath.push(r);var o=c(t,e[r]);t.currentPath.pop(r),"function"==typeof e[r]?t.mapper.set(n,r,e[r](),n):Object.defineProperty(n,r,{enumerable:!0,get:function(){return t.currentStore=this,o}})}),Object.defineProperty(n,"export",{enumerable:!1,value:function(){return a.export(n,t.mapper)}}),Object.defineProperty(n,"import",{enumerable:!1,value:function(e){return a.import(e,t,[])}}),Object.freeze(n),n};t.exports=r},function(t,e,n){"use strict";var r=n(2),o=function(){function t(e){var n=Array.apply(Array);return n=n.concat(e),n.__proto__=t.prototype,n}return t.prototype=Object.create(Array.prototype),t.prototype.push=function(t){return this.__.update(this,function(e,n,r){n.currentPath.push(e.length),Array.prototype.push.call(e,r(n,t)),n.currentPath.pop()})},t.prototype.splice=function(){var t=[].slice.call(arguments,0),e=t.shift(),n=t.shift();return this.__.update(this,function(r,o,i){var u=t.map(function(t,n){o.currentPath.push(e+n);var r=i(o,t);return o.currentPath.pop(),r});Array.prototype.splice.apply(r,[e,n].concat(u));for(var a=e;a<r.length;a++)if(r[a].__){var s=r[a].__.path;s[s.length-1]=a}})},t.prototype.concat=function(){var t=[].slice.call(arguments,0);return this.__.update(this,function(e,n,r){t.map(function(t){Array.isArray(t)?t.map(function(t){n.currentPath.push(e.length),Array.prototype.push.call(e,r(n,t)),n.currentPath.pop()}):(n.currentPath.push(e.length),Array.prototype.push.call(e,r(n,t)),n.currentPath.pop())})})},t.prototype.unshift=function(t){return this.__.update(this,function(e,n,r){Array.prototype.unshift.call(e,r(n,t));for(var o=0;o<e.length;o++)if(e[o].__){var i=e[o].__.path;i[i.length-1]=o}})},t.prototype.shift=function(){return this.__.update(this,function(t,e,n){Array.prototype.shift.call(t);for(var r=0;r<t.length;r++)if(t[r].__){var o=t[r].__.path;o[o.length-1]=r}})},t.prototype.pop=function(){return this.__.update(this,function(t){Array.prototype.pop.call(t)})},t.prototype.toJS=function(){return r.toJS(this)},function(e,n){var r=new t(e);return Object.defineProperty(r,"__",{value:{path:n.currentPath.slice(0),update:n.update}}),r}};t.exports=o()},function(t,e,n){"use strict";var r=n(2),o=(n(4),function(){var t={set:function(t,e){return this.__.update(this,function(n,r,o){Array.isArray(e)&&e.forEach(function(t,e){t.__&&(t.__.path[t.__.path.length-1]=e)}),r.currentPath.push(t),n[t]=o(r,e),r.currentPath.pop()})},toJS:function(){return r.toJS(this)},merge:function(t){if(Array.isArray(t)||"object"!=typeof t||null===t)throw new Error("You have to pass an object to the merge method");return this.__.update(this,function(e,n,r){Object.keys(t).forEach(function(o){n.currentPath.push(o),e[o]=r(n,t[o]),n.currentPath.pop()})})},unset:function(t){return this.__.update(this,function(e){delete e[t]})}};return function(e,n){var r=Object.create(t);return Object.defineProperty(r,"__",{value:{path:n.currentPath.slice(0),update:n.update,updateMapping:n.updateMapping,currentMapping:n.currentMapping}}),Object.keys(e).forEach(function(t){var o=Object.getOwnPropertyDescriptor(e,t);o&&o.get&&o.set?n.mapper.set(r,t,n.mapper.get(r,t)):"function"==typeof e[t]?n.mapper.set(r,t,e[t]()):r[t]=e[t]}),r}});t.exports=o()},function(t,e){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(t){return"function"==typeof t}function o(t){return"number"==typeof t}function i(t){return"object"==typeof t&&null!==t}function u(t){return void 0===t}t.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(t){if(!o(t)||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},n.prototype.emit=function(t){var e,n,o,a,s,c;if(this._events||(this._events={}),"error"===t&&(!this._events.error||i(this._events.error)&&!this._events.error.length)){if(e=arguments[1],e instanceof Error)throw e;var f=new Error('Uncaught, unspecified "error" event. ('+e+")");throw f.context=e,f}if(n=this._events[t],u(n))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),n.apply(this,a)}else if(i(n))for(a=Array.prototype.slice.call(arguments,1),c=n.slice(),o=c.length,s=0;s<o;s++)c[s].apply(this,a);return!0},n.prototype.addListener=function(t,e){var o;if(!r(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,r(e.listener)?e.listener:e),this._events[t]?i(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,i(this._events[t])&&!this._events[t].warned&&(o=u(this._maxListeners)?n.defaultMaxListeners:this._maxListeners,o&&o>0&&this._events[t].length>o&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace())),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(t,e){function n(){this.removeListener(t,n),o||(o=!0,e.apply(this,arguments))}if(!r(e))throw TypeError("listener must be a function");var o=!1;return n.listener=e,this.on(t,n),this},n.prototype.removeListener=function(t,e){var n,o,u,a;if(!r(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(n=this._events[t],u=n.length,o=-1,n===e||r(n.listener)&&n.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(i(n)){for(a=u;a-- >0;)if(n[a]===e||n[a].listener&&n[a].listener===e){o=a;break}if(o<0)return this;1===n.length?(n.length=0,delete this._events[t]):n.splice(o,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},n.prototype.removeAllListeners=function(t){var e,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[t],r(n))this.removeListener(t,n);else if(n)for(;n.length;)this.removeListener(t,n[n.length-1]);return delete this._events[t],this},n.prototype.listeners=function(t){var e;return e=this._events&&this._events[t]?r(this._events[t])?[this._events[t]]:this._events[t].slice():[]},n.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(r(e))return 1;if(e)return e.length}return 0},n.listenerCount=function(t,e){return t.listenerCount(e)}},function(t,e){function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function o(t){if(f===setTimeout)return setTimeout(t,0);if((f===n||!f)&&setTimeout)return f=setTimeout,setTimeout(t,0);try{return f(t,0)}catch(e){try{return f.call(null,t,0)}catch(e){return f.call(this,t,0)}}}function i(t){if(l===clearTimeout)return clearTimeout(t);if((l===r||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(t);try{return l(t)}catch(e){try{return l.call(null,t)}catch(e){return l.call(this,t)}}}function u(){d&&h&&(d=!1,h.length?g=h.concat(g):v=-1,g.length&&a())}function a(){if(!d){var t=o(u);d=!0;for(var e=g.length;e;){for(h=g,g=[];++v<e;)h&&h[v].run();v=-1,e=g.length}h=null,d=!1,i(t)}}function s(t,e){this.fun=t,this.array=e}function c(){}var f,l,p=t.exports={};!function(){try{f="function"==typeof setTimeout?setTimeout:n}catch(t){f=n}try{l="function"==typeof clearTimeout?clearTimeout:r}catch(t){l=r}}();var h,g=[],d=!1,v=-1;p.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];g.push(new s(t,e)),1!==g.length||d||o(a)},s.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=c,p.addListener=c,p.once=c,p.off=c,p.removeListener=c,p.removeAllListeners=c,p.emit=c,p.prependListener=c,p.prependOnceListener=c,p.listeners=function(t){return[]},p.binding=function(t){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(t){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}},function(e,n){e.exports=t}])});
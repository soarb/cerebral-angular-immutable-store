!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("angular")):"function"==typeof define&&define.amd?define(["angular"],e):"object"==typeof exports?exports.Cerebral=e(require("angular")):t.Cerebral=e(t.angular)}(this,function(t){return function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return t[r].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){(function(e){var r=n(17),o=e.angular||n(22),i=n(19),u=n(4).EventEmitter,a=r.Value,s=function(t,e){var n=new u,o=i(t);t=o;var s=r.Controller({defaultArgs:e,onReset:function(){t=o},onSeek:function(e,r,o){t=t.import(o.initialState),n.emit("change",t)},onUpdate:function(){n.emit("change",t)},onRemember:function(){n.emit("remember",t)},onGet:function(e){return a(e,t)},onSet:function(e,n){e=e.slice();var r=e.pop();t=a(e,t).set(r,n)},onUnset:function(e){e=e.slice();var n=e.pop();t=a(e,t).unset(n)},onPush:function(e,n){t=a(e,t).push(n)},onSplice:function(){var e=[].slice.call(arguments),n=a(e.shift(),t);t=n.splice.apply(n,e)},onMerge:function(e,n){t=a(e,t).merge(n)},onConcat:function(){var e=[].slice.call(arguments),n=a(e.shift(),t);t=n.concat.apply(n,e)},onPop:function(e){t=a(e,t).pop()},onShift:function(e){t=a(e,t).shift()},onUnshift:function(e,n){t=a(e,t).unshift(n)}});return s.injectState=function(e,r){var o=function(n){Object.keys(r).forEach(function(o){e[o]=a(r[o],n||t)}),n&&e.$apply()};e.$on("$destroy",function(){n.removeListener("change",o)}),n.on("change",o),n.on("remember",o),o()},s};o.module("cerebral",[]).provider("cerebral",function(){var t=["$http"],e={},n={};this.setState=function(t){e=t},this.setDefaultArgs=function(t){n=t},this.$get=t.concat([function(){var r=arguments;return n.services=t.reduce(function(t,e,n){return t[e]=r[n],t},{}),new s(e,n)}])}),t.exports=o}).call(e,function(){return this}())},function(t,e,n){(function(e,n){t.exports={getFunctionName:function(t){var e=t.toString();return e=e.substr("function ".length),e=e.substr(0,e.indexOf("("))},merge:function(){var t=[].slice.call(arguments),e=t.shift();return t.reduce(function(t,e){return Object.keys(e||{}).reduce(function(t,n){return t[n]=e[n],t},t)},e)},hasLocalStorage:function(){return"undefined"!=typeof e.localStorage},isPathObject:function(t){return t&&(t.resolve||t.reject)},debounce:function(t,e,n){var r;return function(){var o=this,i=arguments,u=function(){r=null,n||t.apply(o,i)},a=n&&!r;clearTimeout(r),r=setTimeout(u,e),a&&t.apply(o,i)}},isAction:function(t){return"function"==typeof t},isDeveloping:function(){return"undefined"==typeof n||"production"!==n.env.NODE_ENV},extractMatchingPathFunctions:function(t,e){var n=!1,r=function(t,e,o,i){if(n)return n;if("function"==typeof t)i[o.join(".")]=t;else if("object"==typeof t&&!Array.isArray(t)&&null!==t)for(var u in t){if(!(u in e))return n=o.slice().concat(u);o.push(u),r(t[u],e[u],o,i),o.pop(u)}return n||i};return r(t,e,[],{})},setDeep:function(t,e,n){for(var r=e.split("."),o=r.pop();r.length;){var i=r.shift();t=t[i]=t[i]||{}}return t[o]=t[o]?Object.keys(t[o]).reduce(function(e,n){return e[n]=t[o][n],e},n):n,n},extractExternalContextProviders:function(t,e){var n=t.__cerebral_global__;return e&&t[e.join(".")]?n.concat(t[e.join(".")]):n}}}).call(e,function(){return this}(),n(5))},function(t,e){"use strict";var n={toJS:function(t){return t instanceof Array?t.map(function(t){return n.toJS(t)}):"object"==typeof t&&null!==t?Object.keys(t).reduce(function(e,r){return e[r]=n.toJS(t[r]),e},{}):t},makeImmutable:function(t){if(t instanceof Array){var e=t.map(function(t){return n.makeImmutable(t)});return Object.defineProperty(e,"toJS",{value:n.toJS.bind(null,e)}),Object.freeze(e),e}if("object"==typeof t&&null!==t){var e=Object.keys(t).reduce(function(e,r){return e[r]=n.makeImmutable(t[r]),e},{});return Object.defineProperty(e,"toJS",{value:n.toJS.bind(null,e)}),Object.freeze(e),e}return t},export:function(t,e){return t instanceof Array?t.map(function(t){return n.export(t,e)}):"object"==typeof t&&null!==t?Object.keys(t).reduce(function(r,o){return t.__&&e.get(t,o)?r[o]=e.get(t,o).value:r[o]=n.export(t[o],e),r},{}):t},import:function(t,e,r){return Object.keys(t).reduce(function(o,i){if(t[i]instanceof Array||"object"!=typeof t[i]||null===t[i]||!n.getByPath(o,r))return n.getByPath(o,r).set(i,t[i]);r.push(i);var u=n.import(t[i],e,r);return r.pop(),u},e.currentStore)},getByPath:function(t,e){return e.reduce(function(t,e){return t[e]},t)},isSame:function(t,e){return Object.keys(t).reduce(function(n,r){return!!n&&t[r]===e[r]},!0)},copyObject:function(t){return Object.keys(t).reduce(function(e,n){return e[n]=t[n],e},{})}};t.exports=n},function(t,e,n){var r=n(2);t.exports=function(t){return{set:function(e,n,o,i){e.__.currentMapping[e.__.path.slice().concat(n).join("")]=r.copyObject(o),Object.keys(o.deps).forEach(function(n){var r=o.deps[n].join("");t.depsOverview[r]=t.depsOverview[r]||[],t.depsOverview[r].push(e)});var u=o.value,a=void 0,s=null,c=t.currentStore,p=function(){return Object.keys(o.deps).reduce(function(e,n){return e[n]=r.getByPath(t.currentStore,o.deps[n]),e},{})},f=function(){var t=p();return!r.isSame(t,s)};Object.defineProperty(e,n,{get:function(){return i&&(t.currentStore=i),c!==t.currentStore&&s&&f()?(s=p(),a=r.makeImmutable(o.get(u,s))):s&&f()?a=r.makeImmutable(o.get(u,s)):s&&void 0!==a?a:(s=p(),a=r.makeImmutable(o.get(u,s)))},set:function(t){u=t,o.value=t},enumerable:!0,configurable:!0})},get:function(e,n){return t.currentStore.__.currentMapping[e.__.path.slice().concat(n).join("")]}}}},function(t,e){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(t){return"function"==typeof t}function o(t){return"number"==typeof t}function i(t){return"object"==typeof t&&null!==t}function u(t){return void 0===t}t.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(t){if(!o(t)||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},n.prototype.emit=function(t){var e,n,o,a,s,c;if(this._events||(this._events={}),"error"===t&&(!this._events.error||i(this._events.error)&&!this._events.error.length)){if(e=arguments[1],e instanceof Error)throw e;var p=new Error('Uncaught, unspecified "error" event. ('+e+")");throw p.context=e,p}if(n=this._events[t],u(n))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),n.apply(this,a)}else if(i(n))for(a=Array.prototype.slice.call(arguments,1),c=n.slice(),o=c.length,s=0;s<o;s++)c[s].apply(this,a);return!0},n.prototype.addListener=function(t,e){var o;if(!r(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,r(e.listener)?e.listener:e),this._events[t]?i(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,i(this._events[t])&&!this._events[t].warned&&(o=u(this._maxListeners)?n.defaultMaxListeners:this._maxListeners,o&&o>0&&this._events[t].length>o&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace())),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(t,e){function n(){this.removeListener(t,n),o||(o=!0,e.apply(this,arguments))}if(!r(e))throw TypeError("listener must be a function");var o=!1;return n.listener=e,this.on(t,n),this},n.prototype.removeListener=function(t,e){var n,o,u,a;if(!r(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(n=this._events[t],u=n.length,o=-1,n===e||r(n.listener)&&n.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(i(n)){for(a=u;a-- >0;)if(n[a]===e||n[a].listener&&n[a].listener===e){o=a;break}if(o<0)return this;1===n.length?(n.length=0,delete this._events[t]):n.splice(o,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},n.prototype.removeAllListeners=function(t){var e,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[t],r(n))this.removeListener(t,n);else if(n)for(;n.length;)this.removeListener(t,n[n.length-1]);return delete this._events[t],this},n.prototype.listeners=function(t){var e;return e=this._events&&this._events[t]?r(this._events[t])?[this._events[t]]:this._events[t].slice():[]},n.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(r(e))return 1;if(e)return e.length}return 0},n.listenerCount=function(t,e){return t.listenerCount(e)}},function(t,e){function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function o(t){if(p===setTimeout)return setTimeout(t,0);if((p===n||!p)&&setTimeout)return p=setTimeout,setTimeout(t,0);try{return p(t,0)}catch(e){try{return p.call(null,t,0)}catch(e){return p.call(this,t,0)}}}function i(t){if(f===clearTimeout)return clearTimeout(t);if((f===r||!f)&&clearTimeout)return f=clearTimeout,clearTimeout(t);try{return f(t)}catch(e){try{return f.call(null,t)}catch(e){return f.call(this,t)}}}function u(){d&&h&&(d=!1,h.length?y=h.concat(y):v=-1,y.length&&a())}function a(){if(!d){var t=o(u);d=!0;for(var e=y.length;e;){for(h=y,y=[];++v<e;)h&&h[v].run();v=-1,e=y.length}h=null,d=!1,i(t)}}function s(t,e){this.fun=t,this.array=e}function c(){}var p,f,l=t.exports={};!function(){try{p="function"==typeof setTimeout?setTimeout:n}catch(t){p=n}try{f="function"==typeof clearTimeout?clearTimeout:r}catch(t){f=r}}();var h,y=[],d=!1,v=-1;l.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];y.push(new s(t,e)),1!==y.length||d||o(a)},s.prototype.run=function(){this.fun.apply(null,this.array)},l.title="browser",l.browser=!0,l.env={},l.argv=[],l.version="",l.versions={},l.on=c,l.addListener=c,l.once=c,l.off=c,l.removeListener=c,l.removeAllListeners=c,l.emit=c,l.prependListener=c,l.prependOnceListener=c,l.listeners=function(t){return[]},l.binding=function(t){throw new Error("process.binding is not supported")},l.cwd=function(){return"/"},l.chdir=function(t){throw new Error("process.chdir is not supported")},l.umask=function(){return 0}},function(t,e){t.exports=function(t,e,n){return t.module||t.modules||(Object.defineProperty(t,"module",{get:function(){throw new Error('DEPRECATED: Use of "module" in signal "'+e.signal.name+'" and action "'+e.action.name+'" is no longer supported. Please install: https://github.com/cerebral/cerebral-provider-modules to get some more juice!')}}),Object.defineProperty(t,"modules",{get:function(){throw new Error('DEPRECATED: Use of "modules" in signal "'+e.signal.name+'" and action "'+e.action.name+'" is no longer supported. Please install: https://github.com/cerebral/cerebral-provider-modules to get some more juice!')}})),t}},function(t,e,n){var r=n(1);t.exports=function(t,e){var n=e.action,o=e.signal,i=[{},e.payload,n.options.defaultInput?n.options.defaultInput:{}];return r.isDeveloping()&&e.payload&&("object"!=typeof e.payload||"object"==typeof e.payload&&null!==e.payload&&!Array.isArray(e.payload)&&"Object"!==e.payload.constructor.name)&&console.warn('Cerebral - You passed an invalid signal payload to signal "'+o.name+'", it has to be a plain object or nothing. This is the payload: ',e.payload),t.input=r.merge.apply(null,i),t}},function(t,e,n){var r=n(1),o=function(t,e,n){var o=function(){if(o.hasRun)throw new Error("Cerebral - You are running an async output on a synchronous action in "+e+". The action is "+t.name+". Either put it in an array or make sure the output is synchronous");var i="string"==typeof arguments[0]?arguments[0]:null,u=i?arguments[1]:arguments[0];if(r.isDeveloping())try{JSON.stringify(u)}catch(n){throw console.log("Not serializable",u),new Error("Cerebral - Could not serialize output. Please check signal "+e+" and action "+t.name)}if(!i&&!t.options.defaultOutput&&t.options.outputs)throw new Error(['Cerebral: There is a wrong output of action "'+r.getFunctionName(t)+'" in signal "'+e+'". Set defaultOutput or use one of outputs '+JSON.stringify(Object.keys(t.output||t.outputs||{}))].join(""));var a={path:i||t.options.defaultOutput,payload:u||{}};n(a)};return o};t.exports=function(t,e){var n=e.action,i=e.signal.name,u=e.resolve,a=o(n,i,u);return n.outputs&&Object.keys(n.outputs).forEach(function(t){a[t]=a.bind(null,t)}),!u&&r.isDeveloping()&&setTimeout(function(){a.hasRun=!0},0),t.output=a,t}},function(t,e){t.exports=function(t,e,n){return t.services=n.getServices(),t}},function(t,e){t.exports=function(t,e,n){var r=e.action,o=n.getModel(),i=r.isAsync,u=function(t){var e=Object.keys(o.accessors||{}).reduce(function(e,r){return e[r]=function(){var e=[].slice.call(arguments),i=[];return e[0]&&Array.isArray(e[0])?i=e.shift():e[0]&&"string"==typeof e[0]&&(i=e.shift().split(".")),"get"===r&&"function"==typeof arguments[0]?n.get(arguments[0]):o.accessors[r].apply(null,[t.concat(i)].concat(e))},e},{});return Object.keys(o.mutators||{}).reduce(function(e,n){return e[n]=function(){if(i)throw new Error("Cerebral: You can not mutate state in async actions. Output values and set them with a sync action");var e=[],r=[].slice.call(arguments);return Array.isArray(r[0])?e=r.shift():"string"==typeof r[0]&&(e=r.shift().split(".")),o.mutators[n].apply(null,[t.concat(e)].concat(r))},e},e),e.select=function(t){return u("string"==typeof t?t.split("."):t)},e.computed=function(t){return t.get(o.accessors.get([]),!0)},e};return t.state=u([]),t}},function(t,e,n){(function(e){function n(t,e){for(var n=e,r=0;r<t.length;r++){var o=t[r];if(void 0===n[o])return n[o];n=n[o]}return n}function r(t){return Array.isArray(t)&&(t=t.join(".")),t.replace(/\.\*\*|\.\*/,"")}function o(t,e){Object.keys(t).forEach(function(n){var u=t[n].getDepsMap?t[n]:r(t[n]);u.getDepsMap?o(u.getDepsMap(),e):i.registry[u]?i.registry[u].indexOf(e)===-1&&(i.registry[u]=i.registry[u].concat(e)):i.registry[u]=[e]})}function i(t,e){return function(u){if(void 0!==u&&(Array.isArray(u)||null===u||"object"!=typeof u))throw new Error("Cerebral - A computed is passed props that is not an object");u=u||{};var a="function"==typeof t?t(u):t,s=JSON.stringify(a)+(u?JSON.stringify(u):"")+e.toString().replace(/\s/g,"");return o(a,s),{getDepsMap:function(){return a},computedName:e.name,get:function(t,o){if(!o&&i.cache[s])return i.cache[s];var c=Object.keys(a).reduce(function(e,o){if("string"==typeof a[o]||Array.isArray(a[o])){var i=r(a[o]);e[o]=n(i.split("."),t)}else e[o]=a[o].get(t);return e},{}),p=u||{},f=Object.keys(p).reduce(function(t,e){return t[e]=p[e],t},c),l=e(f);return i.cache[s]=l,l}}}}if(i.cache={},i.registry={},i.updateCache=function(t){function e(t,r,o){return Object.keys(t).forEach(function(i){r.push(i);var u=r.join(".");o=t[i]===!0?Object.keys(n).reduce(function(t,e){return 0===u.indexOf(e)||0===e.indexOf(u)?t.concat(n[e]):t},o):e(t[i],r,o),r.pop()}),o}var n=i.registry,r=e(t,[],[]);r.forEach(function(t){delete i.cache[t]})},"test"===e.env.NODE_ENV){var u=function(t,e){return e};u.updateCache=i.updateCache,t.exports=u}else t.exports=i}).call(e,n(5))},function(t,e,n){var r=n(1);t.exports=function(t,e,n){var o={},i=function(e,n){var r=Object.keys(n).reduce(function(t,r){return t[e+"."+r]=n[r],t},{});return t.addSignals(r,{modulePath:e.split(".")})},u=function(e,n){var r=Object.keys(n).reduce(function(t,r){return t[e+"."+r]=n[r],t},{});t.addServices(r)},a=function(t,n){r.setDeep(o,t,n),e.mutators.set(t.split("."),n)},s=function(e,r){var o=null;return 1===arguments.length&&(r=e,e=null,o=function(t){throw new Error("Cerebral - You triggered a signal "+t.signal.name+" while modules are being registered. Do not trigger signals until Cerebral has initialized your application.")},t.on("signalTrigger",o)),Object.keys(r).forEach(function(t){c(t,e,r)}),1===arguments.length&&(t.removeListener("signalTrigger",o),t.emit("modulesLoaded",{modules:n})),n},c=function(e,r,o){var c=o[e],p=e;r&&(e=r+"."+e);var f={name:p,path:e.split(".")},l={name:e,path:f.path.slice(),alias:function(t){n[t]=f},addSignals:i.bind(null,e),addServices:u.bind(null,e),addState:a.bind(null,e),getSignals:function(){var n=t.getSignals(),r=e.split(".");return r.reduce(function(t,e){return t[e]},n)},addModules:s.bind(null,e),addContextProvider:function(n){t.addContextProvider(n,e)}},h=c(l,t);return f.meta=h,l.meta=h,n[e]=f,f};return t.on("reset",function(){e.mutators.merge([],o)}),s}},function(t,e,n){(function(e){var r=n(1),o=n(14),i=n(18),u=n(15),a=n(7),s=n(10),c=n(9),p=n(8),f=n(6),l=e.requestAnimationFrame||function(t){setTimeout(t,0)};t.exports=function(t,e){var n=0,h=[],y=!1;return t.isExecuting=function(){return Boolean(n)},function(d,v,g){r.isDeveloping()&&o(d,v||[]);var m=i(v),b=m.actions,_=function(o,_){var j=Object.keys(g||{}).reduce(function(t,e){return t[e]=g[e],t},{});r.isDeveloping()&&(m=i(v),b=m.actions);var O=Object.keys(_||{}).reduce(function(t,e){return t[e]=_[e],t},j),x={name:d,start:null,isSync:O.immediate,isExecuting:!1,isPrevented:!1,branches:m.branches,duration:0,preventSignalRun:function(){x.isExecuting===!1&&(x.isPrevented=!0)}},w=!1;if(O.branches?(x.isSync=!0,x.branches=O.branches,w=!0,t.emit("predefinedSignal",{signal:x,options:O,payload:o})):t.emit("signalTrigger",{signal:x,options:O,payload:o}),!x.isPrevented){var E=function(){x.start=Date.now(),x.isExecuting=!0,w||(n++,t.emit("signalStart",{signal:x,options:O,payload:o}));var i=function(o,l,h,y){var d=o[l];if(!d)return void(o!==x.branches||w||(o[l-1]&&(o[l-1].duration=Date.now()-h),x.isExecuting=!1,n--,t.emit("signalEnd",{signal:x,options:O,payload:y}),t.emit("change",{signal:x,options:O,payload:y})));if(Array.isArray(d)){if(!w){var v=0,g=d.map(function(n){var o=null,l=new Promise(function(t){o=t});t.emit("actionStart",{action:n,signal:x,options:O,payload:y});var h=b[n.actionIndex],g=[a,s,c,p].concat(r.extractExternalContextProviders(e,O.modulePath)).concat(r.isDeveloping()?f:[]),m=u(g,{action:n,signal:x,options:O,payload:y,resolve:o},t);if(n.isExecuting=!0,r.isDeveloping())try{h(m)}catch(e){throw n.error={name:e.name,message:e.message,stack:h.toString()},t.emit("signalError",{action:n,signal:x,options:O,payload:y}),t.emit("change",{signal:x,options:O,payload:y}),e}else h(m);return l.then(function(e){v++,n.hasExecuted=!0,n.isExecuting=!1,t.emit("actionEnd",{action:n,signal:x,options:O,payload:y});var o=r.merge({},y,e.payload);return e.path&&(n.outputPath=e.path,o=i(n.outputs[e.path],0,Date.now(),o)||o,o.then||v===d.length||t.emit("change",{signal:x,options:O,payload:o})),o})});return t.emit("change",{signal:x,options:O,payload:y}),Promise.all(g).then(function(t){var e=r.merge.apply(null,[{},y].concat(t));return i(o,l+1,Date.now(),e)||e}).catch(function(e){throw t.emit("error",e),e})}d.forEach(function(e){e.signals&&e.signals.forEach(function(e){var n=e.name.split(".").reduce(function(t,e){return t[e]},t.getSignals());n(e.input,{branches:e.branches})}),e.outputPath&&i(e.outputs[e.outputPath],0)}),i(o,l+1)}else{var m=d;if(!w){t.emit("actionStart",{action:m,signal:x,options:O,payload:y});var _={path:null,payload:{}},j=function(t){_=t},E=b[m.actionIndex],A=[a,s,c,p].concat(r.extractExternalContextProviders(e,O.modulePath)).concat(r.isDeveloping()?f:[]),P=u(A,{action:m,signal:x,options:O,payload:y,resolve:j},t);if(r.isDeveloping())try{E(P)}catch(e){throw m.error={name:e.name,message:e.message,stack:e.stack},t.emit("signalError",{action:m,signal:x,options:O,payload:y}),t.emit("change",{signal:x,options:O,payload:y}),e}else E(P);m.isExecuting=!1,m.hasExecuted=!0,o[l+1]&&!Array.isArray(o[l+1])||(m.duration=Date.now()-h);var S=null,k=r.merge({},y,_.payload);return _.path?(m.outputPath=_.path,t.emit("actionEnd",{action:m,signal:x,options:O,payload:y}),S=i(m.outputs[_.path],0,h,r.merge({},y,_.payload)),S&&S.then?S.then(function(t){return i(o,l+1,Date.now(),r.merge({},t,_.payload))}):i(o,l+1,h,r.merge({},k,S))||k):(t.emit("actionEnd",{action:m,signal:x,options:O,payload:y}),i(o,l+1,h,k)||k)}m.mutations.forEach(function(e){t.getModel().mutators[e.name].apply(null,[e.path.slice()].concat(e.args))}),m.outputPath&&i(m.outputs[m.outputPath],0),i(o,l+1)}};i(x.branches,0,Date.now(),o)};x.isSync?E():(h.push(E),y||(l(function(){for(;h.length;)h.shift()();y=!1}),y=!0))}};return _.signalName=d,_}}}).call(e,function(){return this}())},function(t,e,n){var r=n(1);t.exports=function(t,e){var n=function(e,o,i){e.forEach(function(u,a){var s;if("undefined"==typeof u)throw new Error(['Cerebral: Action number "'+a+'" in signal "'+t+'" does not exist. Check that you have spelled it correctly!'].join(""));if(Array.isArray(u))n(u,e,a);else{if(s=e[a+1],u.output&&(o&&"function"==typeof s||!o&&("function"!=typeof s||!s)||o&&"function"!=typeof o[i+1]))throw new Error(['Cerebral: The action "'+r.getFunctionName(u)+'" in signal "'+t+'" has an output definition, but there is no action to receive it. '+(s?"But there are "+JSON.stringify(Object.keys(s))+" paths, should it be outputs?":"")].join(""));if(u.outputs&&(!s||"function"==typeof s))throw new Error(['Cerebral: The action "'+r.getFunctionName(u)+'" in signal "'+t+'" has an output value. There should be these paths: '+JSON.stringify(Array.isArray(u.outputs)?u.outputs:Object.keys(u.outputs))].join(""));if(Array.isArray(u.outputs))s=e[a+1],u.outputs.forEach(function(e){if(!Array.isArray(s[e]))throw new Error(['Cerebral: The action "'+r.getFunctionName(u)+'" in signal "'+t+'" can not find path to its "'+e+'" output'].join(""))});else if(u.outputs)Object.keys(u.outputs).forEach(function(e){if(!Array.isArray(s[e]))throw new Error(['Cerebral: The action "'+r.getFunctionName(u)+'" in signal "'+t+'" can not find path to its "'+e+'" output'].join(""))});else if(!Array.isArray(u)&&"object"==typeof u&&null!==u){var c=e[a-1];Object.keys(u).forEach(function(e){if(!Array.isArray(u[e]))throw new Error(['Cerebral: The paths for action "'+r.getFunctionName(c)+'" in signal "'+t+'" are not valid. They have to be an array"'].join(""))})}}})};n(e)}},function(t,e){t.exports=function(t,e,n){return t=t.reduce(function(t,e){return t.indexOf(e)===-1?t.concat(e):t},[]),t.reduce(function(t,r){return"function"==typeof r?r(t,e,n):Object.keys(r).reduce(function(t,e){return t[e]=r[e],t},t)},{})}},function(t,e){t.exports=function(t,e){if(!Array.isArray(e)&&"string"!=typeof e)throw new Error('Cerebral getByPath - The path: "'+e+'" is not valid');if(Array.isArray(e)||(e=e.split(".")),!t||"object"!=typeof t||Array.isArray(t))throw new Error("Cerebral getByPath - The target is not valid, it has to be an object");return e.reduce(function(t,e){if(t)return t[e]},t)}},function(t,e,n){var r=n(16),o=n(13),i=n(12),u=n(4).EventEmitter,a=n(11),s=function(t){var e=new u,n=t(e),s={},c={},p={},f={__cerebral_global__:[]},l=o(e,f),h=function(){for(var t=arguments[0].split("."),e=t.pop(),n=s;t.length;){var r=t.shift();n=n[r]=n[r]||{}}var o=n[e]=l.apply(null,arguments);return o},y=function(t,e){for(var n=t.split("."),r=n.pop(),o=p;n.length;){var i=n.shift();o=o[i]=o[i]||{}}return o[r]=e,e};return e.getSignals=function(t){return t?r(s,t):s},e.getServices=function(t){return t?r(p,t):p},e.getModel=function(){return n},e.get=function(t){return n.accessors.get("string"==typeof t?t.split("."):t)},e.logModel=function(){return n.logModel()},e.getModules=function(t){return t?c[t]:c},e.addModules=i(e,n,c),e.addSignals=function(t,e){Object.keys(t).forEach(function(n){if(t[n].chain){var r=Object.keys(e||{}).reduce(function(t,n){return t[n]=e[n],t},{}),o=Object.keys(t[n]).reduce(function(e,r){return"chain"!==r&&(e[r]=t[n][r]),e},r);h(n,t[n].chain,o)}else h(n,t[n],e)})},e.addServices=function(t){return Object.keys(t).forEach(function(e){y(e,t[e])}),e.getServices()},e.addContextProvider=function(t,e){e?(f[e]||(f[e]=[]),f[e].push(t)):f.__cerebral_global__.push(t)},e.on("flush",a.updateCache),e};t.exports.getByPath=r,t.exports.Controller=s,t.exports.Computed=a,t.exports.immediate=function(t){return{chain:t,immediate:!0}},t.exports.ServerController=function(t){var e={accessors:{get:function(e){return e="string"==typeof e?e.split("."):e,e.reduce(function(t,e){return t[e]},t)}}};return{isServer:!0,get:function(t){return e.accessors.get(t)}}}},function(t,e,n){var r=n(1),o=function(t,e,n,i,u){var a,s=function(t){return u=!u,t.map(function(e,r){n.push(r);var a=o(e,t,n,i,u);return n.pop(),a}).filter(function(t){return!!t})};if("function"==typeof t&&t.async&&u)return a=e[e.indexOf(t)+1],Array.isArray(a)||"object"!=typeof a?s([t]):(e.splice(e.indexOf(a),1),s([t,a]));if(Array.isArray(t))return t=t.slice(),s(t);if("function"==typeof t){var c={name:t.displayName||r.getFunctionName(t),options:{output:t.output,outputs:t.outputs,defaultOutput:t.defaultOutput,defaultInput:t.defaultInput,input:t.input},duration:0,isAsync:!u,isExecuting:!1,hasExecuted:!1,path:n.slice(),outputs:null,actionIndex:i.indexOf(t)===-1?i.push(t)-1:i.indexOf(t)};return!r.isDeveloping()||t.async||t.outputs||u||console.warn('Cerebral - The action "'+c.name+'" will be run ASYNC even though no outputs are defined. This usually happens when composing chains into chains, which forces actions to run async'),a=e[e.indexOf(t)+1],Array.isArray(a)||"object"!=typeof a||(e.splice(e.indexOf(a),1),c.outputs=Object.keys(a).reduce(function(r,u){if(Array.isArray(t.outputs)&&!~t.outputs.indexOf(u))throw new Error("Cerebral - output path "+u+" doesn't matches to possible otputs defined for "+c.name+" action");return n=n.concat("outputs",u),r[u]=o(a[u],e,n,i,!1),n.pop(),n.pop(),r},{})),c}};t.exports=function(t){var e=[],n=o(t,[],[],e,!1);return{branches:n,actions:e}}},function(t,e,n){"use strict";function r(t){if(!t||"object"!=typeof t||Array.isArray(t)||null===t)throw new Error("You have to pass an object to the store");var e={currentPath:[],currentStore:null,mapper:null,currentMapping:{},depsOverview:{},update:function(t,n){e.currentMapping=a.copyObject(e.currentMapping);var r=t.__.path.join("");return e.depsOverview[r]&&e.depsOverview[r].forEach(function(t){e.currentStore=p(e,t)}),e.currentStore=p(e,t,n),e.currentStore},updateMapping:function(t,n,r){return e.currentStore=p(e,t,function(t,e,o){e.mapper.set(t,n,e.mapper.get(t,n)),e.currentPath.push(n),t[n]=r,e.currentPath.pop()}),e.currentStore}};return e.mapper=u(e),e.currentStore=f(e,t),e.currentStore}var o=n(20),i=n(21),u=n(3),a=n(2),s=function(t,e){return Array.isArray(t)?o(t,e):"object"==typeof t&&null!==t?i(t,e):t},c=function(t,e){if(Array.isArray(e)&&!e.__){var n=e.map(function(e,n){t.currentPath.push(n);var r=c(t,e);return t.currentPath.pop(),r}),r=o(n,t);return Object.freeze(r),r}if("object"!=typeof e||null===e||e.__)return e;var u=Object.keys(e).reduce(function(n,r){return t.currentPath.push(r),n[r]=c(t,e[r]),t.currentPath.pop(),n},{}),a=i(u,t);return Object.freeze(a),a},p=function(t,e,n){t.currentPath=[];var r=e.__.path;r.length||(t.currentStore=e);var o=s(t.currentStore,t),u=o;r.forEach(function(e){t.currentPath.push(e),u[e]=s(u[e],t),u=u[e]}),n&&n(u,t,c),u=o,r.forEach(function(e){u=u[e],Object.freeze(u),t.currentPath.pop()});var p=i(o,t);return Object.keys(o).forEach(function(e){var n=Object.getOwnPropertyDescriptor(o,e);n&&n.get&&n.set?Object.defineProperty(p,e,{get:function(){return t.currentStore=this,n.get()}}):Object.defineProperty(p,e,{enumerable:!0,get:function(){return t.currentStore=this,o[e]}})}),Object.defineProperty(p,"export",{enumerable:!1,value:function(){return a.export(p,t.mapper)}}),Object.defineProperty(p,"import",{enumerable:!1,value:function(e){return a.import(e,t,[])}}),Object.freeze(p),p},f=function(t,e){var n=i({},t);return Object.keys(e).forEach(function(r){t.currentPath.push(r);var o=c(t,e[r]);t.currentPath.pop(r),"function"==typeof e[r]?t.mapper.set(n,r,e[r](),n):Object.defineProperty(n,r,{enumerable:!0,get:function(){return t.currentStore=this,o}})}),Object.defineProperty(n,"export",{enumerable:!1,value:function(){return a.export(n,t.mapper)}}),Object.defineProperty(n,"import",{enumerable:!1,value:function(e){return a.import(e,t,[])}}),Object.freeze(n),n};t.exports=r},function(t,e,n){"use strict";var r=n(2),o=function(){function t(e){var n=Array.apply(Array);return n=n.concat(e),n.__proto__=t.prototype,n}return t.prototype=Object.create(Array.prototype),t.prototype.push=function(t){return this.__.update(this,function(e,n,r){n.currentPath.push(e.length),Array.prototype.push.call(e,r(n,t)),n.currentPath.pop()})},t.prototype.splice=function(){var t=[].slice.call(arguments,0),e=t.shift(),n=t.shift();return this.__.update(this,function(r,o,i){var u=t.map(function(t,n){o.currentPath.push(e+n);var r=i(o,t);return o.currentPath.pop(),r});Array.prototype.splice.apply(r,[e,n].concat(u));for(var a=e;a<r.length;a++)if(r[a].__){var s=r[a].__.path;s[s.length-1]=a}})},t.prototype.concat=function(){var t=[].slice.call(arguments,0);return this.__.update(this,function(e,n,r){t.map(function(t){Array.isArray(t)?t.map(function(t){n.currentPath.push(e.length),Array.prototype.push.call(e,r(n,t)),n.currentPath.pop()}):(n.currentPath.push(e.length),Array.prototype.push.call(e,r(n,t)),n.currentPath.pop())})})},t.prototype.unshift=function(t){return this.__.update(this,function(e,n,r){Array.prototype.unshift.call(e,r(n,t));for(var o=0;o<e.length;o++)if(e[o].__){var i=e[o].__.path;i[i.length-1]=o}})},t.prototype.shift=function(){return this.__.update(this,function(t,e,n){Array.prototype.shift.call(t);for(var r=0;r<t.length;r++)if(t[r].__){var o=t[r].__.path;o[o.length-1]=r}})},t.prototype.pop=function(){return this.__.update(this,function(t){Array.prototype.pop.call(t)})},t.prototype.toJS=function(){return r.toJS(this)},function(e,n){var r=new t(e);return Object.defineProperty(r,"__",{value:{path:n.currentPath.slice(0),update:n.update}}),r}};t.exports=o()},function(t,e,n){"use strict";var r=n(2),o=(n(3),function(){var t={set:function(t,e){return this.__.update(this,function(n,r,o){Array.isArray(e)&&e.forEach(function(t,e){t.__&&(t.__.path[t.__.path.length-1]=e)}),r.currentPath.push(t),n[t]=o(r,e),r.currentPath.pop()})},toJS:function(){return r.toJS(this)},merge:function(t){if(Array.isArray(t)||"object"!=typeof t||null===t)throw new Error("You have to pass an object to the merge method");return this.__.update(this,function(e,n,r){Object.keys(t).forEach(function(o){n.currentPath.push(o),e[o]=r(n,t[o]),n.currentPath.pop()})})},unset:function(t){return this.__.update(this,function(e){delete e[t]})}};return function(e,n){var r=Object.create(t);return Object.defineProperty(r,"__",{value:{path:n.currentPath.slice(0),update:n.update,updateMapping:n.updateMapping,currentMapping:n.currentMapping}}),Object.keys(e).forEach(function(t){var o=Object.getOwnPropertyDescriptor(e,t);o&&o.get&&o.set?n.mapper.set(r,t,n.mapper.get(r,t)):"function"==typeof e[t]?n.mapper.set(r,t,e[t]()):r[t]=e[t]}),r}});t.exports=o()},function(e,n){e.exports=t}])});
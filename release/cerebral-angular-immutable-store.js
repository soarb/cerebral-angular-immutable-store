!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("angular")):"function"==typeof define&&define.amd?define(["angular"],e):"object"==typeof exports?exports.Cerebral=e(require("angular")):t.Cerebral=e(t.angular)}(this,function(t){return function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){(function(e){var r=n(13),i=e.angular||n(18),o=n(14),u=n(5).EventEmitter,a=r.Value,c=function(t,e){var n=new u,i=o(t);t=i;var c=r.Controller({defaultArgs:e,onReset:function(){t=i},onSeek:function(e,r,i){t=t.import(i.initialState),n.emit("change",t)},onUpdate:function(){n.emit("change",t)},onRemember:function(){n.emit("remember",t)},onGet:function(e){return a(e,t)},onSet:function(e,n){e=e.slice();var r=e.pop();t=a(e,t).set(r,n)},onUnset:function(e){e=e.slice();var n=e.pop();t=a(e,t).unset(n)},onPush:function(e,n){t=a(e,t).push(n)},onSplice:function(){var e=[].slice.call(arguments),n=a(e.shift(),t);t=n.splice.apply(n,e)},onMerge:function(e,n){t=a(e,t).merge(n)},onConcat:function(){var e=[].slice.call(arguments),n=a(e.shift(),t);t=n.concat.apply(n,e)},onPop:function(e){t=a(e,t).pop()},onShift:function(e){t=a(e,t).shift()},onUnshift:function(e,n){t=a(e,t).unshift(n)}});return c.injectState=function(e,r){var i=function(n){Object.keys(r).forEach(function(i){e[i]=a(r[i],n||t)}),n&&e.$apply()};e.$on("$destroy",function(){n.removeListener("change",i)}),n.on("change",i),n.on("remember",i),i()},c};i.module("cerebral",[]).provider("cerebral",function(){var t=["$http"],e={},n={};this.setState=function(t){e=t},this.setDefaultArgs=function(t){n=t},this.$get=t.concat([function(){var r=arguments;return n.services=t.reduce(function(t,e,n){return t[e]=r[n],t},{}),new c(e,n)}])}),t.exports=i}).call(e,function(){return this}())},function(t,e){(function(e){t.exports={getFunctionName:function(t){var e=t.toString();return e=e.substr("function ".length),e=e.substr(0,e.indexOf("("))},merge:function(t,e){return e=e||{},Object.keys(e).reduce(function(t,n){return t[n]=e[n],t},t)},hasLocalStorage:function(){return"undefined"!=typeof e.localStorage},isPathObject:function(t){return t&&(t.resolve||t.reject)},debounce:function(t,e,n){var r;return function(){var i=this,o=arguments,u=function(){r=null,n||t.apply(i,o)},a=n&&!r;clearTimeout(r),r=setTimeout(u,e),a&&t.apply(i,o)}},isAction:function(t){return"function"==typeof t}}}).call(e,function(){return this}())},function(t,e){"use strict";var n={toJS:function(t){return t instanceof Array?t.map(function(t){return n.toJS(t)}):"object"==typeof t&&null!==t?Object.keys(t).reduce(function(e,r){return e[r]=n.toJS(t[r]),e},{}):t},makeImmutable:function(t){if(t instanceof Array){var e=t.map(function(t){return n.makeImmutable(t)});return Object.defineProperty(e,"toJS",{value:n.toJS.bind(null,e)}),Object.freeze(e),e}if("object"==typeof t&&null!==t){var e=Object.keys(t).reduce(function(e,r){return e[r]=n.makeImmutable(t[r]),e},{});return Object.defineProperty(e,"toJS",{value:n.toJS.bind(null,e)}),Object.freeze(e),e}return t},export:function(t,e){return t instanceof Array?t.map(function(t){return n.export(t,e)}):"object"==typeof t&&null!==t?Object.keys(t).reduce(function(r,i){return t.__&&e.get(t,i)?r[i]=e.get(t,i).value:r[i]=n.export(t[i],e),r},{}):t},import:function(t,e,r){return Object.keys(t).reduce(function(i,o){if(t[o]instanceof Array||"object"!=typeof t[o]||null===t[o]||!n.getByPath(i,r))return n.getByPath(i,r).set(o,t[o]);r.push(o);var u=n.import(t[o],e,r);return r.pop(),u},e.currentStore)},getByPath:function(t,e){return e.reduce(function(t,e){return t[e]},t)},isSame:function(t,e){return Object.keys(t).reduce(function(n,r){return!!n&&t[r]===e[r]},!0)},copyObject:function(t){return Object.keys(t).reduce(function(e,n){return e[n]=t[n],e},{})}};t.exports=n},function(t,e){t.exports=function(t,e){var n=[String,Number,Array,Object,Boolean];return(t!==String||"string"==typeof e)&&((t!==Number||"number"==typeof e)&&(!(t===Array&&!Array.isArray(e))&&((t!==Object||"object"==typeof e&&!Array.isArray(e)&&null!==e)&&((t!==Boolean||"boolean"==typeof e)&&(n.indexOf(t)!==-1||"function"!=typeof t||t(e))))))}},function(t,e,n){var r=n(2);t.exports=function(t){return{set:function(e,n,i,o){e.__.currentMapping[e.__.path.slice().concat(n).join("")]=r.copyObject(i),Object.keys(i.deps).forEach(function(n){var r=i.deps[n].join("");t.depsOverview[r]=t.depsOverview[r]||[],t.depsOverview[r].push(e)});var u=i.value,a=void 0,c=null,s=t.currentStore,f=function(){return Object.keys(i.deps).reduce(function(e,n){return e[n]=r.getByPath(t.currentStore,i.deps[n]),e},{})},l=function(){var t=f();return!r.isSame(t,c)};Object.defineProperty(e,n,{get:function(){return o&&(t.currentStore=o),s!==t.currentStore&&c&&l()?(c=f(),a=r.makeImmutable(i.get(u,c))):c&&l()?a=r.makeImmutable(i.get(u,c)):c&&void 0!==a?a:(c=f(),a=r.makeImmutable(i.get(u,c)))},set:function(t){u=t,i.value=t},enumerable:!0,configurable:!0})},get:function(e,n){return t.currentStore.__.currentMapping[e.__.path.slice().concat(n).join("")]}}}},function(t,e){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(t){return"function"==typeof t}function i(t){return"number"==typeof t}function o(t){return"object"==typeof t&&null!==t}function u(t){return void 0===t}t.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(t){if(!i(t)||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},n.prototype.emit=function(t){var e,n,i,a,c,s;if(this._events||(this._events={}),"error"===t&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if(e=arguments[1],e instanceof Error)throw e;var f=new Error('Uncaught, unspecified "error" event. ('+e+")");throw f.context=e,f}if(n=this._events[t],u(n))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),n.apply(this,a)}else if(o(n))for(a=Array.prototype.slice.call(arguments,1),s=n.slice(),i=s.length,c=0;c<i;c++)s[c].apply(this,a);return!0},n.prototype.addListener=function(t,e){var i;if(!r(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,r(e.listener)?e.listener:e),this._events[t]?o(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,o(this._events[t])&&!this._events[t].warned&&(i=u(this._maxListeners)?n.defaultMaxListeners:this._maxListeners,i&&i>0&&this._events[t].length>i&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace())),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(t,e){function n(){this.removeListener(t,n),i||(i=!0,e.apply(this,arguments))}if(!r(e))throw TypeError("listener must be a function");var i=!1;return n.listener=e,this.on(t,n),this},n.prototype.removeListener=function(t,e){var n,i,u,a;if(!r(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(n=this._events[t],u=n.length,i=-1,n===e||r(n.listener)&&n.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(o(n)){for(a=u;a-- >0;)if(n[a]===e||n[a].listener&&n[a].listener===e){i=a;break}if(i<0)return this;1===n.length?(n.length=0,delete this._events[t]):n.splice(i,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},n.prototype.removeAllListeners=function(t){var e,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[t],r(n))this.removeListener(t,n);else if(n)for(;n.length;)this.removeListener(t,n[n.length-1]);return delete this._events[t],this},n.prototype.listeners=function(t){var e;return e=this._events&&this._events[t]?r(this._events[t])?[this._events[t]]:this._events[t].slice():[]},n.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(r(e))return 1;if(e)return e.length}return 0},n.listenerCount=function(t,e){return t.listenerCount(e)}},function(t,e,n){n(1);t.exports=function(t,e,n,r){var i=null,o=null,u=[],a=0,c=null,s=null,f=!1,l=!1,p=!1,h=0;return{seek:function(r,a){if(clearTimeout(o),u.forEach(clearTimeout),n.emit("seek",r,!!a,i),!t.isRemembering()){var s=function(t){for(var n=t.name.split("."),r=e;n.length;)r=r[n.shift()];r.call(null,t.payload,t.asyncActionResults.slice())},l=i.signals.filter(function(t){return t.start-i.start<r});if(p=!0,l.forEach(s),p=!1,a){this.createTimer();for(var h=i.signals.length,g=l.length,v=g;v<h;v++){var m=i.signals[v],y=m.start-i.start-r;u.push(setTimeout(s.bind(null,m),y))}f=!0,c=Date.now()}u.push(setTimeout(function(){f=!1,n.emit("change")},i.end-i.start-r)),n.emit("change")}},createTimer:function(){var t=function(){a+=500,n.emit("duration",a),a<i.duration&&(o=setTimeout(t,500),n.emit("change"))}.bind(this);o=setTimeout(t,500)},resetState:function(){n.emit("recorderReset",i.initialState)},record:function(){t.isRemembering()||(i&&this.resetState(),i={initialState:r.getInitialRecordingState&&r.getInitialRecordingState(),start:Date.now(),signals:[]},l=!0,n.emit("change"))},stop:function(){var e=f;if(clearTimeout(o),f=!1,l=!1,!t.isRemembering()&&!e){if(t.isExecutingAsync())throw new Error("Cerebral - You can not stop when async signals are running, make sure to handle that with: cerebral.hasExecutingSignal()");i.end=Date.now(),i.duration=i.end-i.start,n.emit("change")}},pause:function(){if(t.isExecutingAsync())throw new Error("Cerebral - You can not stop when async signals are running, make sure to handle that with: cerebral.hasExecutingSignal()");t.isRemembering()||(s=Date.now(),h=s-c,clearTimeout(o),u.forEach(clearTimeout),n.emit("change"))},addSignal:function(t){i.signals.push(t)},isRecording:function(){return l},isPlaying:function(){return f},isCatchingUp:function(){return p},getRecording:function(){return i},getCurrentSeek:function(){return h}}}},function(t,e,n){(function(e){var r=n(1),i=n(11),o=n(12),u=n(10),a=n(3),c=[],s=!1,f=e.requestAnimationFrame||function(t){setTimeout(t,0)};t.exports=function(t,e,n,l,p,h){return function(){var g=[].slice.call(arguments),v=g.shift(),m=g;return u(v,m),function(){var u=m.slice(),g=arguments[0]===!0,y=g,d=g?arguments[1]:arguments[0],b=g?arguments[2]:arguments[1],_=function(){var c=d||{},s=Date.now(),f={name:v,start:s,actions:[],duration:0,payload:d,asyncActionResults:[]};e.isRecording()&&e.addSignal(f),t.addSignal(f);var g=function(){if(u.length){var v=u.shift();if(v.input&&Object.keys(v.input).forEach(function(t){if("undefined"==typeof c[t]||!a(v.input[t],c[t]))throw new Error(['Cerebral: You are giving the wrong input to the action "'+r.getFunctionName(v)+'" in signal "'+f.name+'". Check the following prop: "'+t+'"'].join(""))}),Array.isArray(v)){var m=v.slice();if(t.isRemembering()||e.isPlaying()){for(;b.length;){var y=b.shift();if(m.shift(),r.merge(c,y.arg),y.path){var d=m.shift();u.splice.apply(u,[0,0].concat(Array.isArray(d[y.path])?d[y.path]:[d[y.path]]))}}g()}else{l.emit("change");var _=Date.now()-s;f.duration=f.duration>_?f.duration:_,t.addAsyncAction();var w=[];Promise.all(m.map(function(t){if(r.isAction(t)){var e=i.async(f.actions,c,p,h),n={name:r.getFunctionName(t),duration:0,mutations:[],output:null,path:null,isAsync:!0};f.actions.push(n),w.push(n);var u=o.async(t);return t.apply(null,e.concat(u.fn)),u.promise}return t})).then(function(e){for(;e.length;){var n=e.shift(),i=w.shift();if(f.asyncActionResults.push(n),i.output=n.arg,r.merge(c,n.arg),n.path){var o=e.shift();i.path=n.path,u.splice.apply(u,[0,0].concat(Array.isArray(o[n.path])?o[n.path]:[o[n.path]]))}}t.removeAsyncAction(),s=Date.now(),g()}).catch(function(t){throw l.emit("error",t),t}),n&&n.update()}}else try{var S=i.sync(f.actions,c,p,h),A={name:r.getFunctionName(v),duration:0,isParallell:!1,mutations:[],output:null,isAsync:!1};f.actions.push(A);var j=o.sync(v,f.name);v.apply(null,S.concat(j));var y=j._result||{};if(r.merge(c,y.arg),A.output=y.arg,y.path){var d=u.shift();u.splice.apply(u,[0,0].concat(d[y.path]))}g()}catch(t){throw l.emit("error",t),t}}else if(!t.isRemembering()&&!e.isCatchingUp()){l.emit("change");var _=Date.now()-s;f.duration=f.duration>_?f.duration:_,n&&n.update()}};g()};y||t.isRemembering()||e.isCatchingUp()?_():(c.push(_),s||(f(function(){for(;c.length;)c.shift()();s=!1}),s=!0))}}}}).call(e,function(){return this}())},function(t,e,n){(function(e){var r=n(1);t.exports=function(t,n){var i=r.hasLocalStorage()&&localStorage.getItem("cerebral_signals")?JSON.parse(localStorage.getItem("cerebral_signals")):[],o=("undefined"==typeof e||"production"!==e.env.NODE_ENV)&&(!r.hasLocalStorage()||!localStorage.getItem("cerebral_willKeepState")||JSON.parse(localStorage.getItem("cerebral_willKeepState"))),u=0,a=!1,c=i.length-1;return{toggleKeepState:function(){o=!o},addAsyncAction:function(){u++},removeAsyncAction:function(){u--},addSignal:function(t){c++,a||(o||(i=[],c=0),c<i.length&&i.splice(c,i.length-c),i.push(t))},rememberNow:function(){i.length&&this.remember(i.length-1)},reset:function(){a||(i=[],c=-1,n.emit("reset"))},remember:function(e){if(a=!0,n.emit("reset"),e===-1)c=e,a=!1;else{c=-1;try{for(var r=0;r<=e;r++){var o=i[r];if(!o)break;for(var u=o.name.split("."),s=t;u.length;)s=s[u.shift()];s.call(null,o.payload,o.asyncActionResults.slice()),c=r}a=!1}catch(t){a=!1,this.reset()}}n.emit("remember")},getSignals:function(){return i},isExecutingAsync:function(){return!!u},isRemembering:function(){return a},willKeepState:function(){return o},getCurrentIndex:function(){return c}}}}).call(e,n(17))},function(t,e,n){var r=n(1);t.exports=function(t,e){var n=function(){return{props:{signals:t.getSignals(),willKeepState:t.willKeepState(),currentSignalIndex:t.getCurrentIndex(),isExecutingAsync:t.isExecutingAsync(),isRemembering:t.isRemembering()}}},i=r.debounce(function(){var t=new CustomEvent("cerebral.dev.update",{detail:n()});window.dispatchEvent(t)},50),o=function(){var t=new CustomEvent("cerebral.dev.initialized",{detail:n()});window.dispatchEvent(t)};return window.addEventListener("cerebral.dev.initialize",function(){t.remember(t.getSignals().length-1),o()}),o(),window.addEventListener("cerebral.dev.toggleKeepState",function(){t.toggleKeepState(),i()}),window.addEventListener("cerebral.dev.resetStore",function(){t.reset(),e.emit("change"),i()}),window.addEventListener("cerebral.dev.remember",function(e){t.remember(e.detail),i()}),window.addEventListener("cerebral.dev.logPath",function(t){var n=t.detail.name,r=e.get(t.detail.path);console.log("CEREBRAL - "+n+":",r.toJS?r.toJS():r)}),window.addEventListener("unload",function(){r.hasLocalStorage()&&localStorage.setItem("cerebral_signals",JSON.stringify(t.getSignals())),r.hasLocalStorage()&&localStorage.setItem("cerebral_willKeepState",JSON.stringify(t.willKeepState()))}),{update:i}}},function(t,e,n){var r=n(1);t.exports=function(t,e){var n=function(e,i,o){e.forEach(function(u,a){if(Array.isArray(u))n(u,e,a);else{var c=e[a+1];if(u.output&&(i&&"function"==typeof c||!i&&("function"!=typeof c||!c)||i&&"function"!=typeof i[o+1]))throw new Error(['Cerebral: The action "'+r.getFunctionName(u)+'" in signal "'+t+'" has an output definition, but there is no action to receive it. '+(c?"But there are "+JSON.stringify(Object.keys(c))+" paths, should it be outputs?":"")].join(""));if(u.outputs&&(!c||"function"==typeof c))throw new Error(['Cerebral: The action "'+r.getFunctionName(u)+'" in signal "'+t+'" has an output value. There should be these paths: '+JSON.stringify(Object.keys(u.outputs))].join(""));if(Array.isArray(u.outputs)){var c=e[a+1];u.outputs.forEach(function(e){if(!Array.isArray(c[e]))throw new Error(['Cerebral: The action "'+r.getFunctionName(u)+'" in signal "'+t+'" can not find path to its "'+e+'" output'].join(""))})}else u.outputs&&Object.keys(u.outputs).forEach(function(e){if(!Array.isArray(c[e]))throw new Error(['Cerebral: The action "'+r.getFunctionName(u)+'" in signal "'+t+'" can not find path to its "'+e+'" output'].join(""))})}})};n(e)}},function(t,e,n){var r=n(1),i=function(t,e,n){var r={};return r.get=function(){var t=arguments.length?Array.isArray(arguments[0])?arguments[0]:[].slice.call(arguments):[];return e.get(t)},Object.keys(e.mutators||{}).reduce(function(r,i){return r[i]=function(){if(n)throw new Error("Cerebral: You can not mutate state in async actions. Output values and set them with a sync action");var r=[],o=[].slice.call(arguments);return Array.isArray(o[0])?r=o.shift():"string"==typeof o[0]&&(r=[o.shift()]),t[t.length-1].mutations.push({name:i,path:r.slice(),args:o}),e.mutators[i].apply(null,[r.slice()].concat(o))},r},r),r};t.exports={sync:function(t,e,n,o){return[r.merge(r.merge({},e),o||{}),i(t,n,!1)]},async:function(t,e,n,o){return[r.merge(r.merge({},e),o||{}),i(t,n,!0)]}}},function(t,e,n){var r=n(1),i=n(3),o=function(t,e,n,o){if((t.output||t.outputs)&&!Array.isArray(t.outputs)){if(!n)throw new Error(['Cerebral: There is no output of action "'+r.getFunctionName(t)+'" in signal "'+o+'". It should have '+JSON.stringify(Object.keys(t.output||t.outputs[e]))].join(""));var u=t.output||t.outputs[e||t.defaultOutput];Object.keys(u).forEach(function(e){if(!i(u[e],n[e]))throw new Error(['Cerebral: There is a wrong output of action "'+r.getFunctionName(t)+'" in signal "'+o+'". Check the following prop: "'+e+'"'].join(""))})}},u=function(t,e,n){var i=function(){var u="string"==typeof arguments[0]?arguments[0]:null,a=u?arguments[1]:arguments[0];if(!u&&!t.defaultOutput&&t.outputs)throw new Error(['Cerebral: There is a wrong output of action "'+r.getFunctionName(t)+'" in signal "'+e+'". Set defaultOutput or use one of outputs '+JSON.stringify(Object.keys(t.output||t.outputs))].join(""));o(t,u,a,e);var c={path:u?u:t.defaultOutput,arg:a};n?n(c):i._result=c};return i},a=function(t,e){t.outputs?Array.isArray(t.outputs)?t.outputs.forEach(function(t){e[t]=e.bind(null,t)}):Object.keys(t.outputs).forEach(function(t){e[t]=e.bind(null,t)}):(e.success=e.bind(null,"success"),e.error=e.bind(null,"error"))};t.exports={sync:function(t,e){var n=u(t,e);return a(t,n),n},async:function(t,e){var n=null,r=new Promise(function(t){n=t}),i=u(t,e,n);return a(t,i),{fn:i,promise:r}}}},function(t,e,n){var r=n(7),i=n(8),o=n(6),u=n(9),a=n(5).EventEmitter;t.exports=function(t,e){var n=new a,c=t(n),s={},f=null,l=i(s,n);"undefined"!=typeof window&&"undefined"!=typeof window.addEventListener&&(f=u(l,n));var p=o(l,s,n,c),h=r(l,p,f,n,c,e);return n.signal=function(){s[arguments[0]]=h.apply(null,arguments)},n.defaultInput=e,n.signals=s,n.store=l,n.recorder=p,n.get=function(){var t=arguments.length?"string"==typeof arguments[0]?[].slice.call(arguments):arguments[0]:[];return c.get(t)},n}},function(t,e,n){"use strict";function r(t){if(!t||"object"!=typeof t||Array.isArray(t)||null===t)throw new Error("You have to pass an object to the store");var e={currentPath:[],currentStore:null,mapper:null,currentMapping:{},depsOverview:{},update:function(t,n){e.currentMapping=a.copyObject(e.currentMapping);var r=t.__.path.join("");return e.depsOverview[r]&&e.depsOverview[r].forEach(function(t){e.currentStore=f(e,t)}),e.currentStore=f(e,t,n),e.currentStore},updateMapping:function(t,n,r){return e.currentStore=f(e,t,function(t,e,i){e.mapper.set(t,n,e.mapper.get(t,n)),e.currentPath.push(n),t[n]=r,e.currentPath.pop()}),e.currentStore}};return e.mapper=u(e),e.currentStore=l(e,t),e.currentStore}var i=n(15),o=n(16),u=n(4),a=n(2),c=function(t,e){return Array.isArray(t)?i(t,e):"object"==typeof t&&null!==t?o(t,e):t},s=function(t,e){if(Array.isArray(e)&&!e.__){var n=e.map(function(e,n){t.currentPath.push(n);var r=s(t,e);return t.currentPath.pop(),r}),r=i(n,t);return Object.freeze(r),r}if("object"!=typeof e||null===e||e.__)return e;var u=Object.keys(e).reduce(function(n,r){return t.currentPath.push(r),n[r]=s(t,e[r]),t.currentPath.pop(),n},{}),a=o(u,t);return Object.freeze(a),a},f=function(t,e,n){t.currentPath=[];var r=e.__.path;r.length||(t.currentStore=e);var i=c(t.currentStore,t),u=i;r.forEach(function(e){t.currentPath.push(e),u[e]=c(u[e],t),u=u[e]}),n&&n(u,t,s),u=i,r.forEach(function(e){u=u[e],Object.freeze(u),t.currentPath.pop()});var f=o(i,t);return Object.keys(i).forEach(function(e){var n=Object.getOwnPropertyDescriptor(i,e);n&&n.get&&n.set?Object.defineProperty(f,e,{get:function(){return t.currentStore=this,n.get()}}):Object.defineProperty(f,e,{enumerable:!0,get:function(){return t.currentStore=this,i[e]}})}),Object.defineProperty(f,"export",{enumerable:!1,value:function(){return a.export(f,t.mapper)}}),Object.defineProperty(f,"import",{enumerable:!1,value:function(e){return a.import(e,t,[])}}),Object.freeze(f),f},l=function(t,e){var n=o({},t);return Object.keys(e).forEach(function(r){t.currentPath.push(r);var i=s(t,e[r]);t.currentPath.pop(r),"function"==typeof e[r]?t.mapper.set(n,r,e[r](),n):Object.defineProperty(n,r,{enumerable:!0,get:function(){return t.currentStore=this,i}})}),Object.defineProperty(n,"export",{enumerable:!1,value:function(){return a.export(n,t.mapper)}}),Object.defineProperty(n,"import",{enumerable:!1,value:function(e){return a.import(e,t,[])}}),Object.freeze(n),n};t.exports=r},function(t,e,n){"use strict";var r=n(2),i=function(){function t(e){var n=Array.apply(Array);return n=n.concat(e),n.__proto__=t.prototype,n}return t.prototype=Object.create(Array.prototype),t.prototype.push=function(t){return this.__.update(this,function(e,n,r){n.currentPath.push(e.length),Array.prototype.push.call(e,r(n,t)),n.currentPath.pop()})},t.prototype.splice=function(){var t=[].slice.call(arguments,0),e=t.shift(),n=t.shift();return this.__.update(this,function(r,i,o){var u=t.map(function(t,n){i.currentPath.push(e+n);var r=o(i,t);return i.currentPath.pop(),r});Array.prototype.splice.apply(r,[e,n].concat(u));for(var a=e;a<r.length;a++)if(r[a].__){var c=r[a].__.path;c[c.length-1]=a}})},t.prototype.concat=function(){var t=[].slice.call(arguments,0);return this.__.update(this,function(e,n,r){t.map(function(t){Array.isArray(t)?t.map(function(t){n.currentPath.push(e.length),Array.prototype.push.call(e,r(n,t)),n.currentPath.pop()}):(n.currentPath.push(e.length),Array.prototype.push.call(e,r(n,t)),n.currentPath.pop())})})},t.prototype.unshift=function(t){return this.__.update(this,function(e,n,r){Array.prototype.unshift.call(e,r(n,t));for(var i=0;i<e.length;i++)if(e[i].__){var o=e[i].__.path;o[o.length-1]=i}})},t.prototype.shift=function(){return this.__.update(this,function(t,e,n){Array.prototype.shift.call(t);for(var r=0;r<t.length;r++)if(t[r].__){var i=t[r].__.path;i[i.length-1]=r}})},t.prototype.pop=function(){return this.__.update(this,function(t){Array.prototype.pop.call(t)})},t.prototype.toJS=function(){return r.toJS(this)},function(e,n){var r=new t(e);return Object.defineProperty(r,"__",{value:{path:n.currentPath.slice(0),update:n.update}}),r}};t.exports=i()},function(t,e,n){"use strict";var r=n(2),i=(n(4),function(){var t={set:function(t,e){return this.__.update(this,function(n,r,i){Array.isArray(e)&&e.forEach(function(t,e){t.__&&(t.__.path[t.__.path.length-1]=e)}),r.currentPath.push(t),n[t]=i(r,e),r.currentPath.pop()})},toJS:function(){return r.toJS(this)},merge:function(t){if(Array.isArray(t)||"object"!=typeof t||null===t)throw new Error("You have to pass an object to the merge method");return this.__.update(this,function(e,n,r){Object.keys(t).forEach(function(i){n.currentPath.push(i),e[i]=r(n,t[i]),n.currentPath.pop()})})},unset:function(t){return this.__.update(this,function(e){delete e[t]})}};return function(e,n){var r=Object.create(t);return Object.defineProperty(r,"__",{value:{path:n.currentPath.slice(0),update:n.update,updateMapping:n.updateMapping,currentMapping:n.currentMapping}}),Object.keys(e).forEach(function(t){var i=Object.getOwnPropertyDescriptor(e,t);i&&i.get&&i.set?n.mapper.set(r,t,n.mapper.get(r,t)):"function"==typeof e[t]?n.mapper.set(r,t,e[t]()):r[t]=e[t]}),r}});t.exports=i()},function(t,e){function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function i(t){if(f===setTimeout)return setTimeout(t,0);if((f===n||!f)&&setTimeout)return f=setTimeout,setTimeout(t,0);try{return f(t,0)}catch(e){try{return f.call(null,t,0)}catch(e){return f.call(this,t,0)}}}function o(t){if(l===clearTimeout)return clearTimeout(t);if((l===r||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(t);try{return l(t)}catch(e){try{return l.call(null,t)}catch(e){return l.call(this,t)}}}function u(){v&&h&&(v=!1,h.length?g=h.concat(g):m=-1,g.length&&a())}function a(){if(!v){var t=i(u);v=!0;for(var e=g.length;e;){for(h=g,g=[];++m<e;)h&&h[m].run();m=-1,e=g.length}h=null,v=!1,o(t)}}function c(t,e){this.fun=t,this.array=e}function s(){}var f,l,p=t.exports={};!function(){try{f="function"==typeof setTimeout?setTimeout:n}catch(t){f=n}try{l="function"==typeof clearTimeout?clearTimeout:r}catch(t){l=r}}();var h,g=[],v=!1,m=-1;p.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];g.push(new c(t,e)),1!==g.length||v||i(a)},c.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=s,p.addListener=s,p.once=s,p.off=s,p.removeListener=s,p.removeAllListeners=s,p.emit=s,p.prependListener=s,p.prependOnceListener=s,p.listeners=function(t){return[]},p.binding=function(t){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(t){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}},function(e,n){e.exports=t}])});